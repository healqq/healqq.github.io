<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>gmail api test</title>
     <!--    <link rel="stylesheet" href="css/main.css" type="text/css"> -->
		 <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<!-- 		 <script src="http://vkontakte.ru/js/api/openapi.js" type="text/javascript"></script> -->
<!-- 		<script src="js/gmail_wrap.js"></script> -->
	 	
		
		<script>
			
	
		
		
		var ResponseObject = (function(){
			return {};
		});
		var responseObject = new ResponseObject();
		window.onload = function(){
		
			var query = window.location.hash;
			var validationInfo = null;
			var tokens = [];
			if ( query !== ''){
				var response = query.substr(1).split('&');
				for ( var i=0; i< response.length; i++){
					tokens = response[i].split('=');
					responseObject[tokens[0]] = tokens[1];
					
				}
				console.log(responseObject);
			}
			var btn = document.getElementById('test');
			btn.onclick  = 
			(function(){
				window.location.href ='https://accounts.google.com/o/oauth2/auth?\
				scope=email%20profile%20https://www.googleapis.com/auth/gmail.modify&\
				state=%2Fprofile&\
				redirect_uri=http://healqq.github.io/bettergmail/&\
				response_type=token&\
				client_id=431831242446-c651r3f8nd3kaide989r7goilfbrkeu5.apps.googleusercontent.com';
				
			});
			
			var ajaxSendValidate =( function(){
			
				$.post('https://www.googleapis.com/oauth2/v1/tokeninfo',
					{
						access_token: responseObject.access_token 
						
					}
				).done(function(data){
					validationInfo = data;
					console.log( data );
				})
			});
		$('#validate_token').on('click', ajaxSendValidate );
			var ajaxSendGetEmails =( function(){
			
				$.get('https://www.googleapis.com/gmail/v1/users/'+
				validationInfo.user_id+'/messages '	).done(
					function(data){
					console.log( data );
					}
				)
			});
		$('#load_emails').on('click', ajaxSendGetEmails );
		}

	
	
	
	
		</script>
	
		
    </head>
    <body>
		
		<label>Id опроса </label>
		<input id='poll-id' type='text'>
		<input type='button' id='test' value='auth'>
		<input type='button' id='validate_token' value='validate'>
		<input type='button' id='load_emails' value='load'>
		
		
		
    </body>
</html>
